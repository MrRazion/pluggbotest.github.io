<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLUGG BOT</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-safe-area-inset-top: 0px;
            --tg-safe-area-inset-bottom: 0px;
            --tg-safe-area-inset-left: 0px;
            --tg-safe-area-inset-right: 0px;
            --primary-bg: #0a0a0a;
            --secondary-bg: #121212;
            --card-bg: #1a1a1a;
            --text-color: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --accent-color: #4a86ff;
            --success-color: #34c759;
            --error-color: #ff3b30;
            --border-radius-lg: 20px;
            --border-radius-md: 16px;
            --border-radius-sm: 12px;
            --shadow-soft: 0 4px 24px rgba(0, 0, 0, 0.3);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.25);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background: var(--primary-bg);
            color: var(--text-color);
            min-height: 100vh;
            padding-top: var(--tg-safe-area-inset-top);
            padding-bottom: var(--tg-safe-area-inset-bottom);
            padding-left: var(--tg-safe-area-inset-left);
            padding-right: var(--tg-safe-area-inset-right);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .library-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(74, 134, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            transition: var(--transition);
            z-index: 2;
        }
        
        .library-btn:hover {
            background: rgba(74, 134, 255, 0.2);
            color: var(--accent-color);
        }
        
        .library-btn.active {
            color: var(--success-color);
            background: rgba(52, 199, 89, 0.2);
        }
        
        /* Search bar */
        .search-bar {
            margin-bottom: 20px;
            position: relative;
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }
        
        .search-bar input {
            width: 100%;
            padding: 14px 15px 14px 45px;
            background: var(--secondary-bg);
            border: none;
            border-radius: var(--border-radius-md);
            color: var(--text-color);
            font-size: 15px;
        }
        
        .search-bar input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-color);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        /* Game grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .game-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: var(--transition);
            box-shadow: var(--shadow-card);
            position: relative;
            cursor: pointer;
            transform: translateY(0);
        }
        
        .game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 28px rgba(0, 0, 0, 0.3);
        }
        
        .game-image {
            width: 100%;
            height: 140px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(45deg, #1a1a1a, #252525);
        }
        
        .game-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
            opacity: 0.9;
        }
        
        .game-card:hover .game-image img {
            transform: scale(1.05);
        }
        
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
        }
        
        .game-info {
            padding: 15px;
        }
        
        .game-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .game-description {
            font-size: 13px;
            color: var(--text-secondary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 36px;
        }
        
        /* Library item - improved design */
        .library-item {
            background: var(--card-bg);
            border-radius: var(--border-radius-md);
            overflow: hidden;
            transition: var(--transition);
            box-shadow: var(--shadow-card);
            position: relative;
            cursor: pointer;
            transform: translateY(0);
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .library-item-image {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .library-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .library-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .library-item-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .library-item-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 8px;
        }
        
        /* Profile modal */
        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .profile-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .profile-modal-content {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .profile-modal.active .profile-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .profile-header {
            position: relative;
            height: 180px;
            overflow: hidden;
        }
        
        .banner-placeholder {
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            position: relative;
        }
        
        .banner-edit {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .banner-edit:hover {
            background: rgba(74, 134, 255, 0.6);
        }
        
        .profile-info {
            padding: 20px;
            position: relative;
            margin-top: -60px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--secondary-bg);
            overflow: hidden;
            margin: 0 auto 15px;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            font-size: 24px;
            cursor: pointer;
            position: relative;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-edit {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
        
        .profile-name {
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .verified-badge {
            width: 18px;
            height: 18px;
            position: relative;
            cursor: pointer;
        }
        
        .verified-badge img {
            width: 100%;
            height: 100%;
        }
        
        .verified-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 10;
        }
        
        .verified-badge:hover .verified-tooltip {
            opacity: 1;
        }
        
        .profile-username {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        .profile-bio {
            color: var(--text-color);
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.4;
            font-size: 15px;
        }
        
        .profile-tabs {
            display: flex;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .profile-tab.active {
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
        }
        
        .profile-content {
            padding: 15px;
        }
        
        .profile-section {
            display: none;
        }
        
        .profile-section.active {
            display: block;
        }
        
        .setting-item {
            margin-bottom: 20px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .setting-input {
            width: 100%;
            padding: 12px;
            background: var(--card-bg);
            border: none;
            border-radius: var(--border-radius-md);
            color: var(--text-color);
            font-size: 15px;
        }
        
        .setting-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-color);
        }
        
        .save-btn {
            width: 100%;
            padding: 12px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            margin-top: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .save-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(106, 17, 203, 0.3);
        }
        
        .username-available {
            color: var(--success-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .username-unavailable {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .logout-btn {
            width: 100%;
            padding: 14px;
            background: rgba(255, 59, 48, 0.1);
            color: var(--error-color);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            margin-top: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            background: rgba(255, 59, 48, 0.2);
        }
        
        /* Auth modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .auth-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .auth-modal-content {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 400px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .auth-modal.active .auth-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .plugg-auth-container {
            padding: 0 20px 20px;
        }
        
        .plugg-auth-content {
            text-align: center;
        }
        
        .plugg-auth-gif {
            margin-bottom: 15px;
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }
        
        .plugg-auth-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 10px;
        }
        
        .plugg-auth-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        
        .telegram-auth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .telegram-auth-btn:hover {
            background: #0077b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 119, 179, 0.3);
        }
        
        .telegram-icon {
            width: 24px;
            height: 24px;
        }
        
        /* Registration progress */
        .registration-progress {
            display: none;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: var(--primary-bg);
            z-index: 10;
        }
        
        .progress-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Game details */
        .game-details {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-bg);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            padding-top: var(--tg-safe-area-inset-top);
            padding-bottom: var(--tg-safe-area-inset-bottom);
            padding-left: var(--tg-safe-area-inset-left);
            padding-right: var(--tg-safe-area-inset-right);
        }
        
        .game-details.active {
            display: block;
        }
        
        .game-details-content {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--shadow-card);
        }
        
        .game-details-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .game-details-icon {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            overflow: hidden;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .game-details-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .game-details-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .game-details-meta {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .game-details-description {
            line-height: 1.5;
            color: var(--text-color);
            margin-bottom: 20px;
        }
        
        .game-details-description p {
            margin-bottom: 15px;
        }
        
        .game-details-description ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .game-details-description li {
            margin-bottom: 8px;
            position: relative;
        }
        
        .game-details-description li:before {
            content: "•";
            color: var(--accent-color);
            font-weight: bold;
            position: absolute;
            left: -12px;
        }
        
        .game-details-whats-new {
            margin-top: 20px;
        }
        
        .game-details-whats-new h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .game-details-whats-new ul {
            padding-left: 20px;
        }
        
        .game-details-whats-new li {
            margin-bottom: 8px;
            position: relative;
        }
        
        .game-details-whats-new li:before {
            content: "→";
            color: var(--accent-color);
            position: absolute;
            left: -15px;
        }
        
        .download-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            margin-top: 15px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .download-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(106, 17, 203, 0.3);
        }
        
        .download-btn:active {
            transform: translateY(0);
        }
        
        .details-library-btn {
            width: 100%;
            padding: 12px;
            background: rgba(74, 134, 255, 0.1);
            color: var(--accent-color);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            margin-top: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .details-library-btn.active {
            background: var(--success-color);
            color: white;
        }
        
        /* Banner selector */
        .banner-selector {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-bg);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .banner-selector.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .banner-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .banner-selector-close {
            color: var(--accent-color);
            font-weight: 500;
            cursor: pointer;
        }
        
        .banner-selector-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .banner-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            flex: 1;
            overflow-y: auto;
        }
        
        .banner-item {
            aspect-ratio: 16/9;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }
        
        .banner-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .banner-item.selected::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px solid var(--accent-color);
            border-radius: var(--border-radius-sm);
        }
        
        .banner-upload {
            background: var(--card-bg);
            border-radius: var(--border-radius-md);
            padding: 15px;
            text-align: center;
            margin-top: 10px;
            cursor: pointer;
        }
        
        .banner-upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--accent-color);
        }
        
        /* Avatar selector */
        .avatar-selector {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-bg);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .avatar-selector.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .avatar-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .avatar-selector-close {
            color: var(--accent-color);
            font-weight: 500;
            cursor: pointer;
        }
        
        .avatar-selector-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .avatar-upload {
            background: var(--card-bg);
            border-radius: var(--border-radius-md);
            padding: 15px;
            text-align: center;
            margin-top: 10px;
            cursor: pointer;
        }
        
        .avatar-upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--accent-color);
        }
        
        .avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 3px solid var(--accent-color);
        }
        
        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Library grid */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        /* Footer */
        .footer {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in-up {
            animation: fadeInUp 0.3s ease forwards;
        }
        
        /* Responsive design */
        @media (min-width: 768px) {
            .container {
                max-width: 750px;
            }
            
            .games-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .library-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Main content -->
    <div class="container">
        <div class="header">
            <div class="logo">PLUGG</div>
            <button class="library-btn" id="library-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 1 2 2v1"></path>
                </svg>
            </button>
        </div>
        
        <div class="search-bar">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" id="search-input" placeholder="Search for games...">
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="all">All</div>
            <div class="tab" data-tab="action">Action</div>
        </div>
        
        <div class="tab-content" id="all-tab">
            <div class="games-grid"></div>
        </div>
        
        <div class="tab-content" id="action-tab" style="display: none;">
            <div class="games-grid"></div>
        </div>
    </div>
    
    <!-- Game details page -->
    <div class="game-details" id="game-details">
        <button id="back-btn" style="background: none; border: none; color: var(--accent-color); font-weight: 500; margin-bottom: 15px; cursor: pointer;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"></path>
            </svg> Back
        </button>
        
        <div class="game-details-content">
            <div class="game-details-header">
                <div class="game-details-icon">
                    <img id="details-image" src="" alt="Game icon">
                </div>
                <div>
                    <div class="game-details-title" id="details-title"></div>
                    <div class="game-details-meta" id="details-meta"></div>
                </div>
            </div>
            
            <div class="game-details-description">
                <p id="details-description"></p>
                <ul>
                    <li>Thanks for using PLUGG BOT!</li>
                </ul>
            </div>
            
            <div class="game-details-whats-new">
                <h3>What's New</h3>
                <ul id="details-whats-new"></ul>
            </div>
            
            <button class="download-btn" id="download-btn">Download</button>
            <button class="details-library-btn" id="details-library-btn">Add to Library</button>
        </div>
    </div>
    
    <!-- Profile modal -->
    <div class="profile-modal" id="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-header">
                <div class="banner-placeholder" id="banner-placeholder">
                    <div class="banner-edit" id="banner-edit">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="profile-info">
                <div class="profile-avatar" id="profile-avatar">
                    <div class="avatar-edit">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"></path>
                        </svg>
                    </div>
                </div>
                <div class="profile-name" id="profile-name"></div>
                <div class="profile-username" id="profile-username"></div>
                <div class="profile-bio" id="profile-bio"></div>
            </div>
            
            <div class="profile-tabs">
                <div class="profile-tab active" data-tab="library">Library</div>
                <div class="profile-tab" data-tab="settings">Settings</div>
            </div>
            
            <div class="profile-content">
                <div class="profile-section active" id="library-section">
                    <div class="library-grid" id="library-grid">
                        <!-- Library items will be added here -->
                    </div>
                </div>
                
                <div class="profile-section profile-settings" id="settings-section">
                    <div class="setting-item">
                        <div class="setting-label">Name</div>
                        <input type="text" class="setting-input" id="name-input" placeholder="Enter your name">
                        <button class="save-btn" id="save-name">Save</button>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">Username</div>
                        <input type="text" class="setting-input" id="username-input" placeholder="Enter your username">
                        <div class="username-available">Username available</div>
                        <div class="username-unavailable">Username already taken</div>
                        <button class="save-btn" id="save-username">Save</button>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">Bio</div>
                        <input type="text" class="setting-input" id="bio-input" placeholder="Tell us about yourself">
                        <button class="save-btn" id="save-bio">Save</button>
                    </div>
                    
                    <button class="logout-btn" id="logout-btn">Log Out</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Auth modal -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-modal-content">
            <div class="plugg-auth-container">
                <div class="plugg-auth-content">
                    <div class="plugg-auth-gif">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="url(#gradient)" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M12 8v8M8 12h8" />
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#6a11cb" />
                                    <stop offset="100%" stop-color="#2575fc" />
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <h2 class="plugg-auth-title">PLUGG ID</h2>
                    <p class="plugg-auth-description">Sign in with Telegram to access your account and save your game library</p>
                    <button class="telegram-auth-btn" id="telegram-auth-btn">
                        <svg class="telegram-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.192 8.327c.468-.202.655-.566.332-.969l-2.589-3.236c-.202-.252-.566-.252-.768 0l-1.717 1.717 4.208 2.104c.252.15.332.252.15.416-.15.126-.378.102-.63 0l-2.256-1.128-5.464 5.212c-.227.227-.227.516 0 .743l3.459 3.459c.227.227.59.227.842 0l2.256-2.256 2.589-7.273c.15-.444.566-.655.944-.416z"/>
                        </svg>
                        Continue with Telegram
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Registration progress -->
    <div class="registration-progress" id="registration-progress">
        <div class="progress-spinner"></div>
    </div>
    
    <!-- Banner selector -->
    <div class="banner-selector" id="banner-selector">
        <div class="banner-selector-header">
            <div class="banner-selector-close" id="banner-selector-close">Cancel</div>
            <div class="banner-selector-title">Select Banner</div>
            <div class="banner-selector-apply" id="banner-apply-btn" style="color: var(--accent-color); font-weight: 500; cursor: pointer;">Apply</div>
        </div>
        
        <div class="banner-gallery" id="banner-gallery">
            <!-- Banner items will be added here -->
        </div>
        
        <div class="banner-upload" id="banner-upload">
            <svg class="banner-upload-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <div>Upload from device</div>
            <input type="file" id="banner-file-input" accept="image/*" style="display: none;">
        </div>
    </div>
    
    <!-- Avatar selector -->
    <div class="avatar-selector" id="avatar-selector">
        <div class="avatar-selector-header">
            <div class="avatar-selector-close" id="avatar-selector-close">Cancel</div>
            <div class="avatar-selector-title">Select Avatar</div>
            <div class="avatar-selector-apply" id="avatar-apply-btn" style="color: var(--accent-color); font-weight: 500; cursor: pointer;">Apply</div>
        </div>
        
        <div class="avatar-preview">
            <img id="avatar-preview-img" src="" alt="Avatar preview">
        </div>
        
        <div class="banner-upload" id="avatar-upload">
            <svg class="banner-upload-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <div>Upload from device</div>
            <input type="file" id="avatar-file-input" accept="image/*" style="display: none;">
        </div>
    </div>
    
    <div class="footer">
        <p>PLUGG BOT &copy; 2023</p>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = Telegram.WebApp;
        tg.expand();
        
        // DOM Elements
        const libraryBtn = document.getElementById('library-btn');
        const searchInput = document.getElementById('search-input');
        const tabs = document.querySelectorAll('.tab');
        const profileModal = document.getElementById('profile-modal');
        const authModal = document.getElementById('auth-modal');
        const telegramAuthButton = document.getElementById('telegram-auth-btn');
        const registrationProgress = document.getElementById('registration-progress');
        const profileName = document.getElementById('profile-name');
        const profileUsername = document.getElementById('profile-username');
        const profileBio = document.getElementById('profile-bio');
        const profileAvatar = document.getElementById('profile-avatar');
        const bannerPlaceholder = document.getElementById('banner-placeholder');
        const bannerEdit = document.getElementById('banner-edit');
        const profileEdit = document.getElementById('profile-edit');
        const profileTabs = document.querySelectorAll('.profile-tab');
        const librarySection = document.getElementById('library-section');
        const settingsSection = document.getElementById('settings-section');
        const nameInput = document.getElementById('name-input');
        const usernameInput = document.getElementById('username-input');
        const bioInput = document.getElementById('bio-input');
        const saveNameBtn = document.getElementById('save-name');
        const saveUsernameBtn = document.getElementById('save-username');
        const saveBioBtn = document.getElementById('save-bio');
        const nameAvailable = document.getElementById('name-available');
        const usernameAvailable = document.getElementById('username-available');
        const usernameUnavailable = document.getElementById('username-unavailable');
        const logoutBtn = document.getElementById('logout-btn');
        const libraryGrid = document.getElementById('library-grid');
        const bannerSelector = document.getElementById('banner-selector');
        const bannerSelectorClose = document.getElementById('banner-selector-close');
        const bannerGallery = document.getElementById('banner-gallery');
        const bannerUpload = document.getElementById('banner-upload');
        const bannerFileInput = document.getElementById('banner-file-input');
        const bannerApplyBtn = document.getElementById('banner-apply-btn');
        const avatarSelector = document.getElementById('avatar-selector');
        const avatarSelectorClose = document.getElementById('avatar-selector-close');
        const avatarPreviewImg = document.getElementById('avatar-preview-img');
        const avatarUpload = document.getElementById('avatar-upload');
        const avatarFileInput = document.getElementById('avatar-file-input');
        const avatarApplyBtn = document.getElementById('avatar-apply-btn');
        const backBtn = document.getElementById('back-btn');
        const detailsLibraryBtn = document.getElementById('details-library-btn');
        const gameDetails = document.getElementById('game-details');
        const detailsTitle = document.getElementById('details-title');
        const detailsImage = document.getElementById('details-image');
        const detailsMeta = document.getElementById('details-meta');
        const detailsDescription = document.getElementById('details-description');
        const detailsWhatsNew = document.getElementById('details-whats-new');
        const downloadBtn = document.getElementById('download-btn');
        
        // User data
        let currentUser = null;
        let selectedBannerFile = null;
        let selectedAvatarFile = null;
        let currentDownloadUrl = '';
        let currentFileName = '';
        let currentGameTitle = '';
        let currentGameId = null;
        let currentTab = 'all';
        
        // Game data
        const games = [
            {
                id: 'standrise',
                title: 'StandRise',
                description: 'Private server StandRise is a private server for the popular game Standoff 2, which opens up unlimited possibilities and a new level of freedom for players. Here there are no strict restrictions that hinder your gaming process, and all content becomes available without additional effort. The server provides',
                whatsNew: ['New gift', 'All from Standoff 0.35.0 (New pack, new collection action, maps, new weapons, etc.)', 'Added daily calls', 'Spectator mode', 'Clans', 'Weapon rebalance from original', 'Improved rating games with first season', 'New action with skins from "Gambit" spin (Butterfly, etc.)'],
                image: 'https://avatars.mds.yandex.net/i?id=0e819955e77d734dbf74a1628015204f_l-12569562-images-thumbs&n=13',
                categories: ['action'],
                url: 'https://huggingface.co/Zerchi/test/resolve/main/standleoprivate3.0.apk',
                fileName: 'standleoprivate3.0.apk',
                version: '3.0',
                size: '2.01 GB'
            },
            {
                id: 'projectevolution',
                title: 'Project Evolution',
                description: 'Private server Project Evolution is a modification of the popular shooter Standoff 2, offering players unique opportunities and many additional functions. This server provides excellent conditions for all lovers of intense and exciting online battles, with powerful settings and elaboration of all elements.',
                whatsNew: ['Fixed errors when entering the game.', 'Added clans', 'Added "Competitive" mode'],
                image: 'https://5play.info/_ld/14/1487.webp',
                categories: ['action'],
                url: 'https://huggingface.co/Zerchi/test/resolve/main/CrossOffClassic-1.1F2.apk',
                fileName: 'CrossOffClassic-1.1F2.apk',
                version: '1.1 (F2)',
                size: '499.1 MB'
            },
            {
                id: 'standknife',
                title: 'StandKnife',
                description: 'Private server StandKnife Simulator is a well-known private server that reworks the concept of the popular shooter Standoff 2 and focuses the entire gameplay on mastering cold weapons.',
                whatsNew: ['Fixed errors when entering the game.'],
                image: 'https://edroid.ru/wp-content/uploads/2024/02/4-31.webp',
                categories: ['action'],
                url: 'https://huggingface.co/Zerchi/test/resolve/main/StandKnife%202.9%20(f3).apk',
                fileName: 'StandKnife 2.9 (f3).apk',
                version: '2.9 (f3)',
                size: '2.08 GB'
            },
            {
                id: 'standchillow',
                title: 'StandChillow',
                description: 'StandChillow is an exciting shooter for Android that offers saturated team battles based on the popular mobile action Standoff 2. The game transports you to the world of tactical battles, where each clash tests your combat skills.',
                whatsNew: ['Fixed errors when entering the game.', 'Added clans', 'Added "Competitive" mode'],
                image: 'https://5play.info/_ld/14/1487.webp',
                categories: ['action'],
                url: 'https://huggingface.co/Zerchi/test/resolve/main/CrossOffClassic-1.1F2.apk',
                fileName: 'CrossOffClassic-1.1F2.apk',
                version: '1.1 (F2)',
                size: '499.1 MB'
            }
        ];
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is logged in
            if (!checkUser()) {
                authModal.classList.add('active');
            } else {
                profileModal.classList.add('active');
            }
            
            // Render games
            renderGames(currentTab);
            
            // Event listeners
            setupEventListeners();
        });
        
        // Setup all event listeners
        function setupEventListeners() {
            // Library button
            libraryBtn.addEventListener('click', () => {
                if (!checkUser()) {
                    authModal.classList.add('active');
                } else {
                    profileModal.classList.add('active');
                    // Switch to library tab
                    document.querySelectorAll('.profile-tab').forEach(tab => {
                        if (tab.dataset.tab === 'library') {
                            tab.classList.add('active');
                        } else {
                            tab.classList.remove('active');
                        }
                    });
                    librarySection.style.display = 'block';
                    settingsSection.style.display = 'none';
                }
            });
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tab.dataset.tab;
                    renderGames(currentTab);
                    applySearch();
                });
            });
            
            // Search functionality
            searchInput.addEventListener('input', applySearch);
            
            // Profile tab switching
            profileTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    profileTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    if (tab.dataset.tab === 'library' && librarySection && settingsSection) {
                        librarySection.style.display = 'block';
                        settingsSection.style.display = 'none';
                    } else if (tab.dataset.tab === 'settings' && librarySection && settingsSection) {
                        librarySection.style.display = 'none';
                        settingsSection.style.display = 'block';
                    }
                });
            });
            
            // Telegram auth button
            if (telegramAuthButton) {
                telegramAuthButton.addEventListener('click', () => {
                    // Show loading indicator
                    authModal.classList.remove('active');
                    registrationProgress.style.display = 'block';
                    
                    // Use data from Telegram WebApp
                    setTimeout(() => {
                        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                            const user = tg.initDataUnsafe.user;
                            
                            // Create user object
                            const userData = {
                                telegram_id: user.id,
                                first_name: user.first_name,
                                last_name: user.last_name || '',
                                username: user.username || '',
                                auth_date: user.auth_date || Math.floor(Date.now() / 1000),
                                avatar: user.photo_url || '',
                                banner: '',
                                bio: 'Lover of private servers for Standoff 2',
                                library: [],
                                badges: [],
                                pinned_badges: [],
                                created_at: new Date().toISOString()
                            };
                            
                            // Restore saved data
                            const savedData = getSavedUserData(userData.telegram_id);
                            if (savedData) {
                                Object.assign(userData, savedData);
                            }
                            
                            // Save user data
                            saveUserData(userData);
                            currentUser = userData;
                            
                            // Update UI
                            updateProfileUI();
                            
                            // Show profile
                            registrationProgress.style.display = 'none';
                            profileModal.classList.add('active');
                            tg.showAlert('You have successfully logged in to PLUGG ID via Telegram!');
                        } else {
                            registrationProgress.style.display = 'none';
                            authModal.classList.add('active');
                            tg.showAlert('Failed to get data from Telegram. Please try again.');
                        }
                    }, 1000);
                });
            }
            
            // Logout button
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    // Close modal
                    if (profileModal) profileModal.classList.remove('active');
                    // Show auth modal
                    authModal.classList.add('active');
                    // Show alert
                    tg.showAlert('You have logged out of your account');
                });
            }
            
            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                // Close authModal when clicking outside content
                if (authModal && authModal.classList.contains('active') && 
                    !authModal.querySelector('.auth-modal-content').contains(e.target)) {
                    authModal.classList.remove('active');
                }
                
                // Close profileModal when clicking outside content
                if (profileModal && profileModal.classList.contains('active') && 
                    !profileModal.querySelector('.profile-modal-content').contains(e.target)) {
                    profileModal.classList.remove('active');
                }
            });
            
            // Banner edit
            if (bannerEdit) {
                bannerEdit.addEventListener('click', () => {
                    // Show banner selector
                    bannerSelector.classList.add('active');
                    
                    // Clear previous selection
                    selectedBannerFile = null;
                    
                    // Clear gallery
                    bannerGallery.innerHTML = '';
                    
                    // Add default banners
                    const defaultBanners = [
                        'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1547658719-da2b51169166?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1551650975-87deedd944c3?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1506157786151-b8491531f063?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1558655146-d09347e92766?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=600&q=80'
                    ];
                    
                    defaultBanners.forEach(url => {
                        const item = document.createElement('div');
                        item.className = 'banner-item';
                        item.innerHTML = `<img src="${url}" alt="Banner">`;
                        item.addEventListener('click', () => {
                            document.querySelectorAll('.banner-item').forEach(i => i.classList.remove('selected'));
                            item.classList.add('selected');
                            selectedBannerFile = null;
                        });
                        bannerGallery.appendChild(item);
                    });
                });
            }
            
            // Banner selector close
            if (bannerSelectorClose) {
                bannerSelectorClose.addEventListener('click', () => {
                    bannerSelector.classList.remove('active');
                });
            }
            
            // Banner upload
            if (bannerUpload) {
                bannerUpload.addEventListener('click', () => {
                    bannerFileInput.click();
                });
            }
            
            // Banner file input
            if (bannerFileInput) {
                bannerFileInput.addEventListener('change', (e) => {
                    if (e.target.files && e.target.files[0]) {
                        selectedBannerFile = e.target.files[0];
                        document.querySelectorAll('.banner-item').forEach(i => i.classList.remove('selected'));
                    }
                });
            }
            
            // Banner apply button
            if (bannerApplyBtn) {
                bannerApplyBtn.addEventListener('click', () => {
                    if (currentUser) {
                        if (selectedBannerFile) {
                            // If file is selected from gallery
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                currentUser.banner = event.target.result;
                                saveUserData(currentUser);
                                bannerSelector.classList.remove('active');
                                bannerPreview.classList.remove('active');
                                selectedBannerFile = null;
                                updateProfileUI();
                            };
                            reader.readAsDataURL(selectedBannerFile);
                        } else {
                            // If banner is selected from gallery
                            const selectedBanner = bannerGallery.querySelector('.banner-item.selected');
                            if (selectedBanner) {
                                const bannerUrl = selectedBanner.querySelector('img').src;
                                currentUser.banner = bannerUrl;
                                saveUserData(currentUser);
                                bannerSelector.classList.remove('active');
                                updateProfileUI();
                            }
                        }
                    }
                });
            }
            
            // Avatar edit
            if (profileAvatar) {
                profileAvatar.addEventListener('click', () => {
                    // Show avatar selector
                    avatarSelector.classList.add('active');
                    
                    // Clear previous selection
                    selectedAvatarFile = null;
                    
                    // Set current avatar as preview
                    if (currentUser && currentUser.avatar) {
                        avatarPreviewImg.src = currentUser.avatar;
                    }
                });
            }
            
            // Avatar selector close
            if (avatarSelectorClose) {
                avatarSelectorClose.addEventListener('click', () => {
                    avatarSelector.classList.remove('active');
                });
            }
            
            // Avatar upload
            if (avatarUpload) {
                avatarUpload.addEventListener('click', () => {
                    avatarFileInput.click();
                });
            }
            
            // Avatar file input
            if (avatarFileInput) {
                avatarFileInput.addEventListener('change', (e) => {
                    if (e.target.files && e.target.files[0]) {
                        selectedAvatarFile = e.target.files[0];
                        
                        // Preview the image
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            avatarPreviewImg.src = event.target.result;
                        };
                        reader.readAsDataURL(e.target.files[0]);
                    }
                });
            }
            
            // Avatar apply button
            if (avatarApplyBtn) {
                avatarApplyBtn.addEventListener('click', () => {
                    if (currentUser && selectedAvatarFile) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            currentUser.avatar = event.target.result;
                            saveUserData(currentUser);
                            avatarSelector.classList.remove('active');
                            selectedAvatarFile = null;
                            updateProfileUI();
                        };
                        reader.readAsDataURL(selectedAvatarFile);
                    }
                });
            }
            
            // Save name
            if (saveNameBtn && nameInput) {
                saveNameBtn.addEventListener('click', () => {
                    if (nameInput.value.trim() !== '' && currentUser) {
                        // Split name and surname
                        const nameParts = nameInput.value.trim().split(' ');
                        currentUser.first_name = nameParts[0];
                        currentUser.last_name = nameParts.length > 1 ? nameParts.slice(1).join(' ') : '';
                        
                        saveUserData(currentUser);
                        updateProfileUI();
                        
                        nameAvailable.style.display = 'block';
                        setTimeout(() => nameAvailable.style.display = 'none', 2000);
                    }
                });
            }
            
            // Save username
            if (saveUsernameBtn && usernameInput) {
                saveUsernameBtn.addEventListener('click', () => {
                    if (usernameInput.value.trim() !== '' && currentUser) {
                        currentUser.username = usernameInput.value.trim();
                        saveUserData(currentUser);
                        updateProfileUI();
                        
                        usernameAvailable.style.display = 'block';
                        setTimeout(() => usernameAvailable.style.display = 'none', 2000);
                    }
                });
            }
            
            // Save bio
            if (saveBioBtn && bioInput) {
                saveBioBtn.addEventListener('click', () => {
                    if (bioInput.value.trim() !== '' && currentUser) {
                        currentUser.bio = bioInput.value.trim();
                        saveUserData(currentUser);
                        updateProfileUI();
                    }
                });
            }
            
            // Back button
            if (backBtn) {
                backBtn.addEventListener('click', () => {
                    gameDetails.classList.remove('active');
                });
            }
            
            // Download button
            if (downloadBtn) {
                downloadBtn.addEventListener('click', () => {
                    if (currentDownloadUrl) {
                        window.open(currentDownloadUrl, '_blank');
                    }
                });
            }
            
            // Library button in details
            if (detailsLibraryBtn) {
                detailsLibraryBtn.addEventListener('click', () => {
                    if (currentGameId) {
                        toggleGameInLibrary(currentGameId);
                    }
                });
            }
        }
        
        // Check if user exists
        function checkUser() {
            const tgUser = tg.initDataUnsafe?.user;
            if (tgUser) {
                const telegram_id = tgUser.id;
                const savedData = getSavedUserData(telegram_id);
                if (savedData) {
                    currentUser = savedData;
                    updateProfileUI();
                    return true;
                }
            }
            return false;
        }
        
        // Get saved user data
        function getSavedUserData(telegram_id) {
            const savedUsers = JSON.parse(localStorage.getItem('plugg_saved_users') || '{}');
            return savedUsers[telegram_id] || null;
        }
        
        // Save user data
        function saveUserData(userData) {
            const savedUsers = JSON.parse(localStorage.getItem('plugg_saved_users') || '{}');
            savedUsers[userData.telegram_id] = userData;
            localStorage.setItem('plugg_saved_users', JSON.stringify(savedUsers));
        }
        
        // Update profile UI
        function updateProfileUI() {
            if (!profileName || !profileUsername || !profileBio || !nameInput || 
                !usernameInput || !bioInput || !libraryGrid) return;
                
            if (currentUser) {
                // Check user verification
                const isVerified = isUserVerified(currentUser.telegram_id);
                
                // Update name
                let nameHTML = currentUser.first_name + (currentUser.last_name ? ' ' + currentUser.last_name : '');
                
                // Add verification badge if user is verified
                if (isVerified) {
                    nameHTML += `<div class="verified-badge" id="verified-badge">
                        <img src="https://github.com/MrRazion/pluggbotest.github.io/blob/main/badges/status/1761634926844.png?raw=true" alt="Verified">
                        <div class="verified-tooltip" id="verified-tooltip">${getVerifiedDescription(currentUser.telegram_id, currentUser.first_name)}</div>
                    </div>`;
                }
                
                profileName.innerHTML = nameHTML;
                nameInput.value = currentUser.first_name + (currentUser.last_name ? ' ' + currentUser.last_name : '');
                
                // Update username
                const usernameText = currentUser.username ? `@${currentUser.username}` : 'Not specified';
                profileUsername.innerHTML = usernameText;
                usernameInput.value = currentUser.username || '';
                
                // Update bio
                profileBio.textContent = currentUser.bio || 'Add a description of your profile to tell about yourself';
                bioInput.value = currentUser.bio || '';
                
                // Update avatar
                if (currentUser.avatar) {
                    profileAvatar.innerHTML = `<img src="${currentUser.avatar}" alt="Avatar">`;
                    profileAvatar.classList.add('has-avatar');
                } else {
                    // Fallback to Telegram photo or initial if no avatar
                    const initial = currentUser.first_name ? currentUser.first_name[0].toUpperCase() : 'U';
                    profileAvatar.innerHTML = initial;
                    profileAvatar.classList.remove('has-avatar');
                }
                
                // Update banner
                if (currentUser.banner) {
                    bannerPlaceholder.style.backgroundImage = `url('${currentUser.banner}')`;
                    bannerPlaceholder.style.backgroundSize = 'cover';
                    bannerPlaceholder.style.backgroundPosition = 'center';
                    bannerPlaceholder.textContent = '';
                } else {
                    bannerPlaceholder.style.background = 'var(--accent-gradient)';
                    bannerPlaceholder.style.backgroundSize = '';
                    bannerPlaceholder.style.backgroundPosition = '';
                    bannerPlaceholder.textContent = 'Add banner';
                }
                
                // Update library UI
                updateLibraryUI();
            }
        }
        
        // Update library UI
        function updateLibraryUI() {
            if (!libraryGrid) return;
            libraryGrid.innerHTML = '';
            
            if (!currentUser || !currentUser.library || currentUser.library.length === 0) {
                libraryGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--text-secondary);">
                        Your library is empty. Add private servers to your library to find them here!
                    </div>
                `;
                return;
            }
            
            currentUser.library.forEach(gameId => {
                const game = games.find(g => g.id === gameId);
                if (game) {
                    const item = document.createElement('div');
                    item.className = 'library-item animate-fade-in-up';
                    item.innerHTML = `
                        <div class="library-item-image">
                            <img src="${game.image}" alt="${game.title}">
                        </div>
                        <div class="library-item-info">
                            <div class="library-item-title">${game.title}</div>
                            <div class="library-item-meta">
                                <span>Ver: ${game.version}</span>
                                <span>${game.size}</span>
                            </div>
                        </div>
                    `;
                    item.addEventListener('click', () => {
                        // Show game details
                        handleGameClick({ currentTarget: item, dataset: { gameId: game.id } });
                    });
                    libraryGrid.appendChild(item);
                }
            });
        }
        
        // Render games for current tab
        function renderGames(tab) {
            const grid = document.querySelector(`#${tab}-tab .games-grid`);
            if (!grid) return;
            grid.innerHTML = '';
            
            const filteredGames = tab === 'all' ? 
                games : 
                games.filter(game => game.categories.includes(tab));
            
            filteredGames.forEach(game => {
                const card = document.createElement('div');
                card.className = 'game-card animate-fade-in-up';
                card.dataset.gameId = game.id;
                card.innerHTML = `
                    <div class="game-image">
                        <img src="${game.image}" alt="${game.title}">
                        <div class="game-overlay"></div>
                    </div>
                    <div class="game-info">
                        <div class="game-title">${game.title}</div>
                        <div class="game-description">${game.description}</div>
                    </div>
                `;
                card.style.animationDelay = `${Math.random() * 0.3}s`;
                card.addEventListener('click', handleGameClick);
                grid.appendChild(card);
            });
        }
        
        // Apply search filter
        function applySearch() {
            const term = searchInput.value.toLowerCase();
            const grid = document.querySelector(`#${currentTab}-tab .games-grid`);
            if (!grid) return;
            
            Array.from(grid.children).forEach(card => {
                const title = card.querySelector('.game-title').textContent.toLowerCase();
                const description = card.querySelector('.game-description').textContent.toLowerCase();
                
                if (title.includes(term) || description.includes(term)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Handle game click
        function handleGameClick(e) {
            const gameId = e.currentTarget.dataset.gameId;
            const game = games.find(g => g.id === gameId);
            if (game) {
                detailsTitle.textContent = game.title;
                detailsImage.src = game.image;
                detailsImage.alt = game.title;
                detailsMeta.textContent = `Version: ${game.version} • Size: ${game.size}`;
                detailsDescription.innerHTML = `<p>${game.description}</p>`;
                detailsWhatsNew.innerHTML = `<ul>${game.whatsNew.map(item => `<li>${item}</li>`).join('')}</ul>`;
                currentDownloadUrl = game.url;
                currentFileName = game.fileName;
                currentGameTitle = game.title;
                currentGameId = gameId;
                downloadBtn.textContent = 'Download';
                gameDetails.classList.add('active');
                updateDetailsLibraryButton();
            } else {
                tg.showPopup({
                    title: 'Error',
                    message: 'Game not found',
                    buttons: [{ type: 'ok' }]
                });
            }
        }
        
        // Update details library button
        function updateDetailsLibraryButton() {
            if (!detailsLibraryBtn || !currentGameId || !currentUser) return;
            
            if (currentUser.library && currentUser.library.includes(currentGameId)) {
                detailsLibraryBtn.classList.add('active');
                detailsLibraryBtn.textContent = 'Remove from Library';
            } else {
                detailsLibraryBtn.classList.remove('active');
                detailsLibraryBtn.textContent = 'Add to Library';
            }
        }
        
        // Toggle game in library
        function toggleGameInLibrary(gameId) {
            if (!currentUser) {
                authModal.classList.add('active');
                return;
            }
            
            if (!currentUser.library) {
                currentUser.library = [];
            }
            
            const index = currentUser.library.indexOf(gameId);
            if (index === -1) {
                // Add to library
                currentUser.library.push(gameId);
                tg.showAlert('Game added to library!');
            } else {
                // Remove from library
                currentUser.library.splice(index, 1);
                tg.showAlert('Game removed from library!');
            }
            
            // Save updated data
            saveUserData(currentUser);
            
            // Update UI
            updateDetailsLibraryButton();
            updateLibraryUI();
        }
        
        // Check if user is verified
        function isUserVerified(telegram_id) {
            const verifiedUsers = [5772425643, 7942740523, 5507094612];
            return verifiedUsers.includes(Number(telegram_id));
        }
        
        // Get verification description
        function getVerifiedDescription(telegram_id, nickname) {
            const verifiedUsers = {
                5772425643: `${nickname} is the official person and creator of the project.`,
                7942740523: `${nickname} is the official tester and assistant of the project.`,
                5507094612: `${nickname} supported the development of the project and received a special badge.`
            };
            return verifiedUsers[telegram_id] || '';
        }
    </script>
</body>
</html>
