<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLUGG BOT</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-safe-area-inset-top: 0px;
            --tg-safe-area-inset-bottom: 0px;
            --tg-safe-area-inset-left: 0px;
            --tg-safe-area-inset-right: 0px;
            --primary-bg: #0a0a0a;
            --secondary-bg: #121212;
            --card-bg: #1a1a1a;
            --text-color: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --accent-color: #4a86ff;
            --success-color: #34c759;
            --error-color: #ff3b30;
            --border-radius-lg: 20px;
            --border-radius-md: 16px;
            --border-radius-sm: 12px;
            --shadow-soft: 0 4px 24px rgba(0, 0, 0, 0.3);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.25);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background: var(--primary-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding-top: var(--tg-safe-area-inset-top);
            padding-bottom: calc(80px + var(--tg-safe-area-inset-bottom));
            padding-left: var(--tg-safe-area-inset-left);
            padding-right: var(--tg-safe-area-inset-right);
            min-height: 100vh;
            overflow-x: hidden;
            transition: var(--transition);
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 15px;
        }
        
        /* Header with gradient and profile button */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-soft);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-gradient);
            z-index: 1;
        }
        
        .header h1 {
            font-size: 22px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 2;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 5px;
        }
        
        .profile-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .profile-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .profile-icon {
            width: 24px;
            height: 24px;
            color: var(--accent-color);
        }
        
        /* Search bar with modern design */
        .search-bar {
            margin-bottom: 20px;
            position: relative;
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }
        
        .search-bar input {
            width: 100%;
            padding: 14px 15px 14px 45px;
            background: var(--secondary-bg);
            border: none;
            border-radius: var(--border-radius-md);
            color: var(--text-color);
            font-size: 14px;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .search-bar input:focus {
            outline: none;
            box-shadow: 0 4px 12px rgba(74, 134, 255, 0.25);
        }
        
        .search-bar svg {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            fill: var(--text-secondary);
            transition: var(--transition);
        }
        
        /* Tabs with smooth animation */
        .tabs {
            display: flex;
            overflow-x: auto;
            margin-bottom: 20px;
            padding-bottom: 5px;
            scrollbar-width: none;
            gap: 8px;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 10px 20px;
            background: var(--secondary-bg);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 15px;
            color: var(--text-secondary);
            position: relative;
        }
        
        .tab.active {
            color: var(--accent-color);
            background: rgba(74, 134, 255, 0.1);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-color);
            border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
        }
        
        /* Game grid layout */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .game-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-card);
            transition: var(--transition);
            position: relative;
        }
        
        .game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }
        
        .game-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(45deg, #3a3a3a, #4a4a4a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }
        
        .game-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .game-content {
            padding: 15px;
        }
        
        .game-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .game-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
        }
        
        .download-btn {
            width: 100%;
            padding: 16px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(74, 134, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }
        
        .download-btn:hover::before {
            left: 100%;
        }
        
        .download-btn:disabled {
            background: linear-gradient(90deg, #3a3a3a, #4a4a4a);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .download-btn:not(:disabled):active {
            transform: scale(0.97);
        }
        
        .details-library-btn {
            width: 48%;
            padding: 16px;
            background: var(--card-bg);
            color: var(--text-color);
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .details-library-btn.active {
            background: var(--success-color);
            color: white;
        }
        
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-text {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .progress-percent {
            font-weight: 600;
            color: var(--accent-color);
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            border-radius: var(--border-radius-sm);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .download-stats {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-sm);
            padding: 12px;
            display: flex;
            justify-content: space-between;
        }
        
        .download-stats-item {
            display: flex;
            flex-direction: column;
        }
        
        .download-stats-label {
            font-family: monospace;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }
        
        .download-stats-value {
            color: var(--text-color);
            font-weight: 600;
            margin-top: 3px;
        }
        
        .download-visualizer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
        }
        
        .download-visualizer {
            display: none;
            height: 30px;
            width: 200px;
            display: flex;
            align-items: flex-end;
            gap: 2px;
            padding: 5px 0;
        }
        
        .download-bar {
            width: 4px;
            background: var(--accent-color);
            border-radius: 2px;
        }
        
        /* Game details page */
        .game-details {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-bg);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            padding-top: var(--tg-safe-area-inset-top);
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            padding: 10px 15px;
            background: var(--card-bg);
            color: var(--text-color);
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 15px;
            margin-top: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .back-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: var(--transition);
        }
        
        .back-btn:hover::before {
            left: 100%;
        }
        
        .back-btn:hover {
            transform: translateX(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .details-library-btn {
            padding: 10px 15px;
            background: var(--card-bg);
            color: var(--text-color);
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        
        .details-library-btn.active {
            background: var(--success-color);
            color: white;
        }
        
        /* Banner selector */
        .banner-selector {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-bg);
            z-index: 3000;
            padding: 20px;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .banner-selector.active {
            display: flex;
        }
        
        .banner-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .banner-selector-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .banner-selector-close {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--secondary-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .banner-selector-close:hover {
            transform: rotate(90deg);
        }
        
        .banner-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: var(--secondary-bg);
            border-radius: var(--border-radius-md);
            margin-bottom: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .banner-upload:hover {
            background: var(--card-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .banner-gallery {
            width: 100%;
            max-height: 50vh;
            overflow-y: auto;
            padding-right: 5px;
            margin-bottom: 20px;
        }
        
        .banner-gallery::-webkit-scrollbar {
            width: 6px;
        }
        
        .banner-gallery::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .banner-gallery::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }
        
        .banner-gallery-item {
            width: 100%;
            height: 150px;
            border-radius: var(--border-radius-md);
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .banner-gallery-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .banner-gallery-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .banner-gallery-item:hover::after {
            opacity: 1;
        }
        
        .banner-preview {
            display: none;
            width: 100%;
            padding: 15px;
            background: var(--secondary-bg);
            border-radius: var(--border-radius-md);
            margin-top: auto;
        }
        
        .banner-preview.active {
            display: block;
        }
        
        .banner-preview-img {
            width: 100%;
            height: 120px;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .banner-preview-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .banner-preview-actions {
            display: flex;
            gap: 10px;
        }
        
        .banner-preview-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .banner-preview-cancel {
            background: var(--secondary-bg);
            color: var(--text-color);
        }
        
        .banner-preview-apply {
            background: var(--accent-gradient);
            color: white;
        }
        
        /* Profile modal */
        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .profile-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .profile-modal-content {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .profile-modal.active .profile-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .profile-header {
            position: relative;
            height: 160px;
            overflow: hidden;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }
        
        .banner-placeholder {
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            font-size: 14px;
            text-align: center;
            padding: 0 20px;
            cursor: pointer;
            background-size: cover;
            background-position: center;
        }
        
        .profile-info {
            padding: 20px;
            position: relative;
            margin-top: -60px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--secondary-bg);
            background: var(--card-bg);
            overflow: hidden;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            font-size: 24px;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-edit {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .profile-edit:hover {
            transform: scale(1.1);
        }
        
        .profile-name {
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .verified-badge {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }
        
        .verified-badge img {
            width: 15px;
            height: 15px;
        }
        
        .verified-tooltip {
            position: absolute;
            top: -40px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 250px;
            word-break: break-word;
            line-height: 1.3;
        }
        
        .verified-tooltip.show {
            opacity: 1;
        }
        
        .profile-username {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .badge-icon {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .badge-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-bio {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            min-height: 40px;
        }
        
        .profile-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
            gap: 0;
        }
        
        .profile-tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            cursor: pointer;
            font-weight: 500;
            font-size: 15px;
            color: var(--text-secondary);
            transition: var(--transition);
            position: relative;
        }
        
        .profile-tab::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--accent-color);
            transition: var(--transition);
        }
        
        .profile-tab.active {
            color: var(--accent-color);
        }
        
        .profile-tab.active::after {
            width: 80%;
        }
        
        .profile-content {
            padding: 0 20px 20px;
        }
        
        .library-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .library-item {
            aspect-ratio: 9/16;
            background: linear-gradient(45deg, #3a3a3a, #4a4a4a);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            position: relative;
        }
        
        .library-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .library-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
        }
        
        .library-item-title {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            color: white;
            font-size: 11px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .plugg-auth-container {
            padding: 0 20px 20px;
        }
        
        .plugg-auth-content {
            text-align: center;
        }
        
        .plugg-auth-gif {
            margin-bottom: 15px;
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }
        
        .plugg-auth-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 10px;
        }
        
        .plugg-auth-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .plugg-auth-status {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            min-height: 20px;
        }
        
        .plugg-auth-button-container {
            margin-top: 10px;
        }
        
        .plugg-auth-button {
            display: inline-block;
            width: 100%;
            max-width: 300px;
            padding: 14px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(74, 134, 255, 0.3);
            text-decoration: none;
        }
        
        .plugg-auth-button:active {
            transform: scale(0.97);
        }
        
        .registration-progress {
            display: none;
            padding: 20px;
            text-align: center;
        }
        
        .loader {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin: 25px 0 12px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-content {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .section-content p {
            margin-bottom: 10px;
            color: var(--text-secondary);
        }
        
        .section-content ul {
            list-style-type: none;
            padding-left: 10px;
        }
        
        .section-content li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            color: var(--text-secondary);
        }
        
        .section-content li::before {
            content: '•';
            color: var(--accent-color);
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .new-indicator {
            width: 10px;
            height: 10px;
            background: var(--success-color);
            border-radius: 50%;
            margin-left: 5px;
        }
        
        .status-message {
            padding: 12px 15px;
            border-radius: var(--border-radius-md);
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }
        
        .status-success {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
            display: block;
        }
        
        .status-error {
            background: rgba(255, 59, 48, 0.1);
            color: var(--error-color);
            display: block;
        }
        
        .library-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            opacity: 0.7;
            transition: opacity 0.3s;
            font-size: 20px;
            font-weight: bold;
        }
        
        .library-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .library-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .library-btn.prev {
            left: 5px;
        }
        
        .library-btn.next {
            right: 5px;
        }
        
        /* КОНЕЦ СИСТЕМЫ СКРИНШОТОВ */
        .screenshot-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            opacity: 0.7;
            transition: opacity 0.3s;
            font-size: 20px;
            font-weight: bold;
        }
        
        .screenshot-nav:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .screenshot-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .screenshot-nav.prev {
            left: 5px;
        }
        
        .screenshot-nav.next {
            right: 5px;
        }
        
        /* Footer with modern design */
        .footer {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-top: 30px;
            box-shadow: var(--shadow-soft);
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .footer-section {
            padding: 0 10px;
        }
        
        .footer-section h3 {
            font-size: 15px;
            margin-bottom: 10px;
            color: var(--text-color);
            font-weight: 600;
        }
        
        .footer-section p, .footer-section a {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 5px;
            text-decoration: none;
            line-height: 1.5;
        }
        
        .footer-section a {
            color: var(--accent-color);
            transition: var(--transition);
        }
        
        .footer-section a:hover {
            text-decoration: underline;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 10px;
        }
        
        .footer-bottom p {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .profile-settings {
            display: none;
        }
        
        .setting-item {
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .setting-label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-color);
        }
        
        .setting-value {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .setting-value:hover {
            color: var(--accent-color);
        }
        
        .setting-input {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            color: var(--text-color);
            font-size: 14px;
        }
        
        .save-btn {
            margin-top: 10px;
            padding: 10px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
        }
        
        .logout-btn {
            width: 100%;
            padding: 14px;
            background: rgba(255, 59, 48, 0.1);
            color: var(--error-color);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            margin-top: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            background: rgba(255, 59, 48, 0.2);
        }
        
        .username-available {
            color: var(--success-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .username-unavailable {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .tg-theme-light {
            --primary-bg: #f5f5f7;
            --secondary-bg: #ffffff;
            --card-bg: #ffffff;
            --text-color: #1c1c1c;
            --text-secondary: #636366;
            --accent-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --accent-color: #4a86ff;
        }
        
        .gradient-text {
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>PLUGG</h1>
                <p>Ваша игровая библиотека</p>
            </div>
            <button id="profile-btn" class="profile-btn">
                <svg class="profile-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </button>
        </div>

        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Поиск игр...">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="all">Все игры</div>
            <div class="tab" data-tab="new">Новые</div>
            <div class="tab" data-tab="top">Топ</div>
        </div>

        <div id="all-games" class="games-section">
            <div class="games-grid" id="games-grid">
                <!-- Games will be populated here -->
            </div>
        </div>

        <div id="game-details" class="game-details">
            <button class="back-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"></path>
                </svg>
                Назад
            </button>
            <div class="details-header">
                <h2 id="details-title" class="gradient-text">Название игры</h2>
                <button id="library-btn" class="details-library-btn">В библиотеку</button>
            </div>
            <img id="details-image" src="" alt="Обложка игры" style="width: 100%; height: 200px; object-fit: cover; border-radius: 12px; margin-bottom: 15px;">
            <div id="details-meta" style="color: var(--text-secondary); margin-bottom: 15px;"></div>
            <p id="details-description" style="margin-bottom: 20px; color: var(--text-secondary);"></p>
            <h3 style="margin-bottom: 10px; color: var(--text-color);">Что нового</h3>
            <p id="details-whats-new" style="color: var(--text-secondary);"></p>
            <button id="download-btn" class="download-btn">Скачать</button>
            
            <div class="progress-container">
                <div class="progress-info">
                    <span class="progress-text">Загружено: <span id="downloaded-size">0 MB</span></span>
                    <span class="progress-percent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
                </div>
                <div class="download-stats">
                    <div class="download-stats-item">
                        <span class="download-stats-label">Скорость</span>
                        <span class="download-stats-value" id="download-speed">0 MB/s</span>
                    </div>
                    <div class="download-stats-item">
                        <span class="download-stats-label">Пинг</span>
                        <span class="download-stats-value" id="ping-value">0 ms</span>
                    </div>
                </div>
                <div class="download-visualizer-container">
                    <button id="visualizer-toggle" style="background: none; border: none; cursor: pointer;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M17 5v14M7 5v14M2 5h20M2 19h20"></path>
                        </svg>
                    </button>
                    <div id="download-visualizer" class="download-visualizer"></div>
                </div>
            </div>
        </div>

        <div id="auth-modal" class="profile-modal">
            <div class="profile-modal-content">
                <div class="plugg-auth-container">
                    <div class="plugg-auth-content">
                        <div class="plugg-auth-gif">
                            <img src="https://i.imgur.com/9bU4TPl.gif" alt="PLUGG Auth" style="width: 100%; border-radius: 12px;">
                        </div>
                        <h2 class="plugg-auth-title">Войдите в PLUGG</h2>
                        <p class="plugg-auth-description">Для доступа к библиотеке игр и сохранения ваших настроек, войдите с помощью Telegram</p>
                        <div class="plugg-auth-status" id="plugg-auth-status">Ожидание авторизации...</div>
                        <div class="plugg-auth-button-container" id="plugg-auth-button-container">
                            <button id="telegram-auth-button" class="plugg-auth-button">Войти через Telegram</button>
                        </div>
                        <div class="registration-progress" id="registration-progress">
                            <div class="loader"></div>
                            <div class="progress-text">Регистрация аккаунта...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="profile-modal" class="profile-modal">
            <div class="profile-modal-content">
                <div class="profile-header">
                    <div id="banner-placeholder" class="banner-placeholder">Добавьте свой баннер, чтобы выделиться среди других пользователей</div>
                </div>
                <div class="profile-info">
                    <div id="profile-avatar" class="profile-avatar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <div class="profile-edit" id="profile-edit">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 20h9"></path>
                            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                        </svg>
                    </div>
                    <h2 class="profile-name" id="profile-name">Имя Фамилия</h2>
                    <p class="profile-username" id="profile-username">@username</p>
                    <p class="profile-bio" id="profile-bio">Добавьте описание профиля, чтобы рассказать о себе</p>
                </div>
                <div class="profile-tabs">
                    <div class="profile-tab active" data-tab="library">Библиотека</div>
                    <div class="profile-tab" data-tab="settings">Настройки</div>
                </div>
                <div class="profile-content">
                    <div id="library-section">
                        <div class="library-grid" id="library-grid">
                            <!-- Library games will be populated here -->
                        </div>
                    </div>
                    <div id="settings-section" class="profile-settings">
                        <div class="setting-item">
                            <label class="setting-label">Имя</label>
                            <input type="text" id="name-input" class="setting-input">
                            <div class="username-available" id="name-available">Имя доступно</div>
                            <button id="save-name" class="save-btn">Сохранить</button>
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">Юзернейм</label>
                            <input type="text" id="username-input" class="setting-input">
                            <div class="username-available" id="username-available">Юзернейм доступен</div>
                            <div class="username-unavailable" id="username-unavailable">Юзернейм занят</div>
                            <button id="save-username" class="save-btn">Сохранить</button>
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">Описание</label>
                            <textarea id="bio-input" class="setting-input" rows="3" style="resize: none;"></textarea>
                            <button id="save-bio" class="save-btn">Сохранить</button>
                        </div>
                        <button id="logout-btn" class="logout-btn">Выйти</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="banner-selector" class="banner-selector">
            <div class="banner-selector-header">
                <h2 class="banner-selector-title">Выберите баннер</h2>
                <div id="banner-selector-close" class="banner-selector-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </div>
            </div>
            <div class="banner-upload" id="banner-upload">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                <p>Загрузить свой баннер</p>
            </div>
            <div class="banner-gallery" id="banner-gallery">
                <!-- Gallery items will be populated here -->
            </div>
            <div id="banner-preview" class="banner-preview">
                <div class="banner-preview-img">
                    <img id="banner-preview-img" src="" alt="Preview">
                </div>
                <div class="banner-preview-actions">
                    <button id="banner-cancel-btn" class="banner-preview-btn banner-preview-cancel">Отмена</button>
                    <button id="banner-apply-btn" class="banner-preview-btn banner-preview-apply">Применить</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>PLUGG</h3>
                    <p>Ваша игровая библиотека в Telegram</p>
                </div>
                <div class="footer-section">
                    <h3>Полезные ссылки</h3>
                    <a href="#">Правила сообщества</a>
                    <a href="#">Политика конфиденциальности</a>
                    <a href="#">Поддержка</a>
                </div>
                <div class="footer-bottom">
                    <p>© 2023 PLUGG. Все права защищены.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Telegram WebApp initialization
        const tg = Telegram.WebApp;
        tg.expand();
        
        // Initialize theme
        function updateTheme() {
            const themeParams = tg.themeParams;
            document.documentElement.style.setProperty('--tg-theme-bg-color', themeParams.bg_color);
            document.documentElement.style.setProperty('--tg-theme-text-color', themeParams.text_color);
            document.documentElement.style.setProperty('--tg-theme-hint-color', themeParams.hint_color);
            document.documentElement.style.setProperty('--tg-theme-link-color', themeParams.link_color);
            document.documentElement.style.setProperty('--tg-theme-button-color', themeParams.button_color);
            document.documentElement.style.setProperty('--tg-theme-button-text-color', themeParams.button_text_color);
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', themeParams.secondary_bg_color);
            
            // Update safe area insets
            document.documentElement.style.setProperty('--tg-safe-area-inset-top', tg.viewportStableHeight > 0 ? tg.viewportStableHeight + 'px' : 'env(safe-area-inset-top)');
            document.documentElement.style.setProperty('--tg-safe-area-inset-bottom', tg.viewportStableHeight > 0 ? tg.viewportStableHeight + 'px' : 'env(safe-area-inset-bottom)');
            document.documentElement.style.setProperty('--tg-safe-area-inset-left', tg.viewportStableHeight > 0 ? tg.viewportStableHeight + 'px' : 'env(safe-area-inset-left)');
            document.documentElement.style.setProperty('--tg-safe-area-inset-right', tg.viewportStableHeight > 0 ? tg.viewportStableHeight + 'px' : 'env(safe-area-inset-right)');
        }
        
        // Initial theme setup
        updateTheme();
        tg.onEvent('themeChanged', updateTheme);
        
        // DOM elements
        const gamesGrid = document.getElementById('games-grid');
        const gameDetails = document.getElementById('game-details');
        const detailsTitle = document.getElementById('details-title');
        const detailsImage = document.getElementById('details-image');
        const detailsMeta = document.getElementById('details-meta');
        const detailsDescription = document.getElementById('details-description');
        const detailsWhatsNew = document.getElementById('details-whats-new');
        const searchInput = document.getElementById('search-input');
        const profileBtn = document.getElementById('profile-btn');
        const profileModal = document.getElementById('profile-modal');
        const authModal = document.getElementById('auth-modal');
        const pluggAuthStatus = document.getElementById('plugg-auth-status');
        const pluggAuthButtonContainer = document.getElementById('plugg-auth-button-container');
        const telegramAuthButton = document.getElementById('telegram-auth-button');
        const registrationProgress = document.getElementById('registration-progress');
        const profileName = document.getElementById('profile-name');
        const profileUsername = document.getElementById('profile-username');
        const profileBio = document.getElementById('profile-bio');
        const profileAvatar = document.getElementById('profile-avatar');
        const bannerPlaceholder = document.getElementById('banner-placeholder');
        const profileEdit = document.getElementById('profile-edit');
        const profileTabs = document.querySelectorAll('.profile-tab');
        const librarySection = document.getElementById('library-section');
        const settingsSection = document.getElementById('settings-section');
        const nameInput = document.getElementById('name-input');
        const usernameInput = document.getElementById('username-input');
        const bioInput = document.getElementById('bio-input');
        const saveNameBtn = document.getElementById('save-name');
        const saveUsernameBtn = document.getElementById('save-username');
        const saveBioBtn = document.getElementById('save-bio');
        const nameAvailable = document.getElementById('name-available');
        const usernameAvailable = document.getElementById('username-available');
        const usernameUnavailable = document.getElementById('username-unavailable');
        const logoutBtn = document.getElementById('logout-btn');
        const libraryGrid = document.getElementById('library-grid');
        const visualizerToggle = document.getElementById('visualizer-toggle');
        const downloadVisualizer = document.getElementById('download-visualizer');
        const downloadedSize = document.getElementById('downloaded-size');
        const downloadSpeed = document.getElementById('download-speed');
        const pingValue = document.getElementById('ping-value');
        const bannerSelector = document.getElementById('banner-selector');
        const bannerSelectorClose = document.getElementById('banner-selector-close');
        const bannerGallery = document.getElementById('banner-gallery');
        const bannerUpload = document.getElementById('banner-upload');
        const bannerPreview = document.getElementById('banner-preview');
        const bannerPreviewImg = document.getElementById('banner-preview-img');
        const bannerCancelBtn = document.getElementById('banner-cancel-btn');
        const bannerApplyBtn = document.getElementById('banner-apply-btn');
        const libraryBtn = document.getElementById('library-btn');
        const downloadBtn = document.getElementById('download-btn');
        const progressFill = document.getElementById('progress-fill');
        const statusMessage = document.getElementById('status-message');
        
        // Mock game data
        const games = [
            {
                id: 1,
                title: "Minecraft",
                image: "https://i.imgur.com/5Q5uRlD.jpg",
                size: "125 MB",
                rating: "4.8",
                downloads: "1.2M",
                description: "Популярная песочница с открытым миром, где вы можете строить, исследовать и выживать.",
                whatsNew: "Добавлены новые биомы, мобы и улучшена оптимизация для мобильных устройств."
            },
            {
                id: 2,
                title: "Roblox",
                image: "https://i.imgur.com/6Z6Z6Z6.jpg",
                size: "180 MB",
                rating: "4.7",
                downloads: "2.5M",
                description: "Платформа для создания и игры в пользовательские игры.",
                whatsNew: "Улучшена стабильность, добавлены новые инструменты для разработчиков."
            },
            {
                id: 3,
                title: "Subway Surfers",
                image: "https://i.imgur.com/7Z7Z7Z7.jpg",
                size: "145 MB",
                rating: "4.6",
                downloads: "3.1M",
                description: "Бесконечный раннер с красочной графикой и увлекательным геймплеем.",
                whatsNew: "Новые локации, персонажи и обновленные события."
            },
            {
                id: 4,
                title: "Among Us",
                image: "https://i.imgur.com/8Z8Z8Z8.jpg",
                size: "85 MB",
                rating: "4.5",
                downloads: "1.8M",
                description: "Социальная дедуктивная игра для 4-10 игроков онлайн или через локальную сеть.",
                whatsNew: "Новые карты, скины и улучшенная античит система."
            },
            {
                id: 5,
                title: "PUBG Mobile",
                image: "https://i.imgur.com/9Z9Z9Z9.jpg",
                size: "2.1 GB",
                rating: "4.4",
                downloads: "4.5M",
                description: "Игра в жанре королевской битвы с реалистичной графикой и соревновательным геймплеем.",
                whatsNew: "Новое оружие, обновленные карты и улучшенная стабильность."
            },
            {
                id: 6,
                title: "Free Fire",
                image: "https://i.imgur.com/AZAZAZA.jpg",
                size: "1.3 GB",
                rating: "4.3",
                downloads: "3.7M",
                description: "Королевская битва с быстрыми раундами и разнообразными персонажами.",
                whatsNew: "Новые события, скины и оптимизация для слабых устройств."
            }
        ];
        
        // User data
        let currentUser = null;
        let currentGame = null;
        let isDownloading = false;
        let xhr = null;
        let currentFileName = '';
        let downloadedBytes = 0;
        let totalBytes = 0;
        let downloadStartTime = 0;
        let pingInterval = null;
        let visualizerInterval = null;
        let isVisualizerActive = false;
        
        // Initialize the app
        function initApp() {
            // Check if user is authenticated
            if (!checkUser()) {
                showAuthModal();
            } else {
                updateProfileUI();
                renderGames('all');
                setupEventListeners();
            }
        }
        
        // Check if user exists in localStorage
        function checkUser() {
            const user = localStorage.getItem('plugg_user');
            if (user) {
                try {
                    currentUser = JSON.parse(user);
                    return true;
                } catch (e) {
                    console.error('Error parsing user data', e);
                    localStorage.removeItem('plugg_user');
                    return false;
                }
            }
            return false;
        }
        
        // Save user data to localStorage
        function saveUserData() {
            if (currentUser) {
                localStorage.setItem('plugg_user', JSON.stringify(currentUser));
            }
        }
        
        // Create default user if doesn't exist
        function createDefaultUser(userData) {
            const defaultUser = {
                id: userData.id,
                first_name: userData.first_name,
                last_name: userData.last_name || '',
                username: userData.username || '',
                photo_url: userData.photo_url || '',
                auth_date: userData.auth_date,
                hash: userData.hash,
                library: [],
                bio: 'Добавьте описание профиля, чтобы рассказать о себе',
                banner: '',
                is_verified: true
            };
            return defaultUser;
        }
        
        // Show auth modal
        function showAuthModal() {
            authModal.classList.add('active');
            tg.MainButton.setText("Войти через Telegram");
            tg.MainButton.show();
            tg.MainButton.onClick(handleTelegramAuth);
        }
        
        // Hide auth modal
        function hideAuthModal() {
            authModal.classList.remove('active');
            tg.MainButton.hide();
            tg.MainButton.offClick(handleTelegramAuth);
        }
        
        // Handle Telegram authentication
        function handleTelegramAuth() {
            try {
                pluggAuthStatus.textContent = 'Подготовка к авторизации...';
                registrationProgress.style.display = 'block';
                pluggAuthButtonContainer.style.display = 'none';
                
                // Simulate auth process
                setTimeout(() => {
                    const initData = Telegram.WebApp.initData;
                    if (!initData) {
                        pluggAuthStatus.textContent = 'Ошибка авторизации. Попробуйте еще раз.';
                        pluggAuthButtonContainer.style.display = 'block';
                        registrationProgress.style.display = 'none';
                        return;
                    }
                    
                    // Parse user data from initData
                    const urlParams = new URLSearchParams(initData);
                    const user = JSON.parse(decodeURIComponent(urlParams.get('user')));
                    
                    // Create or update user
                    currentUser = createDefaultUser(user);
                    localStorage.setItem('plugg_user', JSON.stringify(currentUser));
                    
                    pluggAuthStatus.textContent = 'Авторизация успешна!';
                    setTimeout(() => {
                        hideAuthModal();
                        updateProfileUI();
                        renderGames('all');
                        setupEventListeners();
                    }, 1000);
                }, 1000);
            } catch (error) {
                console.error('Auth error:', error);
                pluggAuthStatus.textContent = 'Ошибка авторизации: ' + error.message;
                pluggAuthButtonContainer.style.display = 'block';
                registrationProgress.style.display = 'none';
            }
        }
        
        // Update profile UI with current user data
        function updateProfileUI() {
            if (!currentUser) return;
            
            // Update name
            profileName.textContent = `${currentUser.first_name}${currentUser.last_name ? ' ' + currentUser.last_name : ''}`;
            
            // Fixed: Corrected the syntax error here - removed duplicate declaration
            const usernameText = currentUser.username ? `@${currentUser.username}` : 'Не указан';
            profileUsername.innerHTML = usernameText;
            usernameInput.value = currentUser.username || '';
            
            // Update bio
            profileBio.textContent = currentUser.bio || 'Добавьте описание профиля, чтобы рассказать о себе';
            bioInput.value = currentUser.bio || '';
            
            // Update avatar
            if (currentUser.avatar) {
                profileAvatar.innerHTML = `<img src="${currentUser.avatar}" alt="Аватар">`;
            }
            
            // Update banner
            if (currentUser.banner) {
                bannerPlaceholder.style.backgroundImage = `url('${currentUser.banner}')`;
                bannerPlaceholder.style.backgroundSize = 'cover';
                bannerPlaceholder.style.backgroundPosition = 'center';
                bannerPlaceholder.textContent = '';
            } else {
                bannerPlaceholder.style.background = 'var(--accent-gradient)';
                bannerPlaceholder.style.backgroundSize = '';
                bannerPlaceholder.style.backgroundPosition = '';
                bannerPlaceholder.textContent = 'Добавьте свой баннер, чтобы выделиться среди других пользователей';
            }
            
            // Update library UI
            updateLibraryUI();
            
            // Add handler for verification badge hover
            const verifiedBadge = document.querySelector('.verified-badge');
            if (verifiedBadge) {
                const tooltip = document.querySelector('.verified-tooltip');
                verifiedBadge.addEventListener('mouseenter', () => {
                    tooltip.classList.add('show');
                });
                verifiedBadge.addEventListener('mouseleave', () => {
                    tooltip.classList.remove('show');
                });
            }
        }
        
        // Update library UI
        function updateLibraryUI() {
            if (!currentUser || !currentUser.library || currentUser.library.length === 0) {
                libraryGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--text-secondary);">
                        Ваша библиотека пуста
                    </div>
                `;
                return;
            }
            
            libraryGrid.innerHTML = '';
            const libraryGames = games.filter(game => currentUser.library.includes(game.id));
            
            libraryGames.forEach(game => {
                const gameElement = document.createElement('div');
                gameElement.className = 'library-item';
                gameElement.innerHTML = `
                    <img src="${game.image}" alt="${game.title}">
                    <div class="library-item-title">${game.title}</div>
                `;
                gameElement.addEventListener('click', () => showGameDetails(game));
                libraryGrid.appendChild(gameElement);
            });
        }
        
        // Render games based on tab
        function renderGames(tab) {
            const grid = document.getElementById('games-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            let gamesToRender = games;
            if (tab === 'new') {
                gamesToRender = games.slice(0, 2);
            } else if (tab === 'top') {
                gamesToRender = [...games].sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating));
            }
            
            gamesToRender.forEach(game => {
                const gameElement = document.createElement('div');
                gameElement.className = 'game-card';
                gameElement.innerHTML = `
                    <div class="game-image">
                        <img src="${game.image}" alt="${game.title}">
                    </div>
                    <div class="game-content">
                        <h3 class="game-title">${game.title}</h3>
                        <div class="game-meta">
                            <span>${game.size}</span>
                            <span>★ ${game.rating}</span>
                        </div>
                    </div>
                `;
                gameElement.addEventListener('click', () => showGameDetails(game));
                grid.appendChild(gameElement);
            });
        }
        
        // Show game details
        function showGameDetails(game) {
            currentGame = game;
            gameDetails.style.display = 'block';
            
            detailsTitle.textContent = game.title;
            detailsImage.src = game.image;
            detailsMeta.innerHTML = `
                Размер: ${game.size} • Рейтинг: ★ ${game.rating} • Скачано: ${game.downloads}
            `;
            detailsDescription.textContent = game.description;
            detailsWhatsNew.textContent = game.whatsNew;
            
            // Check if game is in library
            if (currentUser && currentUser.library && currentUser.library.includes(game.id)) {
                libraryBtn.textContent = 'Удалить из библиотеки';
                libraryBtn.classList.add('active');
            } else {
                libraryBtn.textContent = 'В библиотеку';
                libraryBtn.classList.remove('active');
            }
        }
        
        // Hide game details
        function hideGameDetails() {
            gameDetails.style.display = 'none';
            currentGame = null;
        }
        
        // Add game to library
        function toggleGameInLibrary(gameId) {
            if (!currentUser) {
                authModal.classList.add('active');
                return;
            }
            
            if (!currentUser.library) {
                currentUser.library = [];
            }
            
            const index = currentUser.library.indexOf(gameId);
            if (index === -1) {
                // Add to library
                currentUser.library.push(gameId);
                tg.showAlert('Игра добавлена в библиотеку!');
                libraryBtn.textContent = 'Удалить из библиотеки';
                libraryBtn.classList.add('active');
            } else {
                // Remove from library
                currentUser.library.splice(index, 1);
                tg.showAlert('Игра удалена из библиотеки!');
                libraryBtn.textContent = 'В библиотеку';
                libraryBtn.classList.remove('active');
            }
            
            // Save updated data
            localStorage.setItem('plugg_user', JSON.stringify(currentUser));
            saveUserData();
            
            // Update library UI
            updateLibraryUI();
        }
        
        // Update progress bar
        function updateProgress(percent, loaded, total) {
            progressFill.style.width = `${percent}%`;
            downloadedSize.textContent = `${(loaded / (1024 * 1024)).toFixed(1)} MB`;
            document.querySelector('.progress-percent').textContent = `${percent}%`;
        }
        
        // Show status message
        function showStatus(message, isSuccess) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message ' + (isSuccess ? 'status-success' : 'status-error');
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }
        
        // Reset download UI
        function resetDownloadUI() {
            isDownloading = false;
            downloadBtn.disabled = false;
            downloadBtn.textContent = 'Скачать';
            document.querySelector('.progress-container').style.display = 'none';
            
            // Stop visualizer
            if (visualizerInterval) {
                clearInterval(visualizerInterval);
                visualizerInterval = null;
            }
            if (downloadVisualizer) {
                downloadVisualizer.style.display = 'none';
            }
            isVisualizerActive = false;
            if (visualizerToggle) {
                visualizerToggle.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M17 5v14M7 5v14M2 5h20M2 19h20"></path></svg>`;
            }
        }
        
        // Animate download visualizer
        function animateDownloadVisualizer() {
            const bars = document.querySelectorAll('.download-bar');
            bars.forEach(bar => {
                const height = Math.floor(Math.random() * 25) + 5;
                bar.style.height = `${height}px`;
            });
        }
        
        // Toggle visualizer
        function toggleVisualizer() {
            if (!isVisualizerActive) {
                downloadVisualizer.style.display = 'flex';
                visualizerToggle.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M5 18h14M5 6h14"></path></svg>`;
                if (visualizerInterval) clearInterval(visualizerInterval);
                visualizerInterval = setInterval(animateDownloadVisualizer, 80);
            } else {
                downloadVisualizer.style.display = 'none';
                visualizerToggle.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M17 5v14M7 5v14M2 5h20M2 19h20"></path></svg>`;
                if (visualizerInterval) clearInterval(visualizerInterval);
                visualizerInterval = null;
            }
            isVisualizerActive = !isVisualizerActive;
        }
        
        // Download file
        function downloadFile() {
            if (!isDownloading && downloadBtn) {
                isDownloading = true;
                downloadBtn.disabled = true;
                downloadBtn.textContent = 'Загрузка...';
                document.querySelector('.progress-container').style.display = 'block';
                
                // Create download visualizer bars
                downloadVisualizer.innerHTML = '';
                for (let i = 0; i < 30; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'download-bar';
                    downloadVisualizer.appendChild(bar);
                }
                
                // Simulate ping
                pingValue.textContent = '...';
                let ping = 0;
                pingInterval = setInterval(() => {
                    ping = Math.floor(Math.random() * 100) + 20;
                    pingValue.textContent = `${ping} ms`;
                }, 1000);
                
                // Start download simulation
                downloadStartTime = Date.now();
                downloadedBytes = 0;
                totalBytes = 100 * 1024 * 1024; // 100 MB
                
                // Create a fake download
                const chunkSize = 5 * 1024 * 1024; // 5 MB chunks
                let chunksDownloaded = 0;
                const totalChunks = Math.ceil(totalBytes / chunkSize);
                
                const downloadInterval = setInterval(() => {
                    chunksDownloaded++;
                    downloadedBytes = Math.min(chunksDownloaded * chunkSize, totalBytes);
                    const percent = Math.round((downloadedBytes / totalBytes) * 100);
                    
                    // Calculate speed
                    const elapsed = (Date.now() - downloadStartTime) / 1000;
                    const speed = downloadedBytes / elapsed / (1024 * 1024); // MB/s
                    
                    updateProgress(percent, downloadedBytes, totalBytes);
                    downloadSpeed.textContent = `${speed.toFixed(1)} MB/s`;
                    
                    if (downloadedBytes >= totalBytes) {
                        clearInterval(downloadInterval);
                        clearInterval(pingInterval);
                        
                        // Create blob and trigger download
                        setTimeout(() => {
                            const blob = new Blob([new ArrayBuffer(chunkSize)], { type: 'application/vnd.android.package-archive' });
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.style.display = 'none';
                            a.href = url;
                            a.download = currentGame.title + '.apk';
                            document.body.appendChild(a);
                            a.click();
                            URL.revokeObjectURL(url);
                            document.body.removeChild(a);
                            updateProgress(100, totalBytes, totalBytes);
                            showStatus('Файл успешно проверен и готов к установке.', true);
                        }, 1500);
                        
                        resetDownloadUI();
                    }
                }, 500);
            }
        }
        
        // Setup all event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    renderGames(tab.dataset.tab);
                });
            });
            
            // Search functionality
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredGames = games.filter(game => 
                        game.title.toLowerCase().includes(searchTerm)
                    );
                    
                    gamesGrid.innerHTML = '';
                    filteredGames.forEach(game => {
                        const gameElement = document.createElement('div');
                        gameElement.className = 'game-card';
                        gameElement.innerHTML = `
                            <div class="game-image">
                                <img src="${game.image}" alt="${game.title}">
                            </div>
                            <div class="game-content">
                                <h3 class="game-title">${game.title}</h3>
                                <div class="game-meta">
                                    <span>${game.size}</span>
                                    <span>★ ${game.rating}</span>
                                </div>
                            </div>
                        `;
                        gameElement.addEventListener('click', () => showGameDetails(game));
                        gamesGrid.appendChild(gameElement);
                    });
                });
            }
            
            // Profile button
            if (profileBtn) {
                profileBtn.addEventListener('click', () => {
                    if (!currentUser) {
                        showAuthModal();
                    } else {
                        profileModal.classList.add('active');
                    }
                });
            }
            
            // Close profile modal
            document.addEventListener('click', (e) => {
                if (profileModal.classList.contains('active') && 
                    !profileModal.contains(e.target) && 
                    e.target !== profileBtn) {
                    profileModal.classList.remove('active');
                }
            });
            
            // Profile tabs
            profileTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    profileTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    if (tab.dataset.tab === 'library') {
                        librarySection.style.display = 'block';
                        settingsSection.style.display = 'none';
                    } else {
                        librarySection.style.display = 'none';
                        settingsSection.style.display = 'block';
                    }
                });
            });
            
            // Library button in game details
            if (libraryBtn) {
                libraryBtn.addEventListener('click', () => {
                    if (currentGame) {
                        toggleGameInLibrary(currentGame.id);
                    }
                });
            }
            
            // Back button
            document.querySelector('.back-btn').addEventListener('click', hideGameDetails);
            
            // Download button
            if (downloadBtn) {
                downloadBtn.addEventListener('click', downloadFile);
            }
            
            // Visualizer toggle
            if (visualizerToggle) {
                visualizerToggle.addEventListener('click', toggleVisualizer);
            }
            
            // Profile edit
            if (profileEdit) {
                profileEdit.addEventListener('click', () => {
                    profileTabs.forEach(t => t.classList.remove('active'));
                    document.querySelector('[data-tab="settings"]').classList.add('active');
                    librarySection.style.display = 'none';
                    settingsSection.style.display = 'block';
                });
            }
            
            // Banner placeholder click
            if (bannerPlaceholder) {
                bannerPlaceholder.addEventListener('click', () => {
                    bannerSelector.classList.add('active');
                });
            }
            
            // Banner selector close
            if (bannerSelectorClose) {
                bannerSelectorClose.addEventListener('click', () => {
                    bannerSelector.classList.remove('active');
                });
            }
            
            // Banner upload
            if (bannerUpload) {
                bannerUpload.addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                bannerPreviewImg.src = event.target.result;
                                bannerPreview.classList.add('active');
                                selectedBannerFile = file;
                            };
                            reader.readAsDataURL(file);
                        }
                    };
                    input.click();
                });
            }
            
            // Banner cancel
            if (bannerCancelBtn) {
                bannerCancelBtn.addEventListener('click', () => {
                    bannerPreview.classList.remove('active');
                    selectedBannerFile = null;
                });
            }
            
            // Banner apply
            if (bannerApplyBtn) {
                bannerApplyBtn.addEventListener('click', () => {
                    if (currentUser) {
                        if (selectedBannerFile) {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                currentUser.banner = event.target.result;
                                saveUserData();
                                updateProfileUI();
                                bannerSelector.classList.remove('active');
                                bannerPreview.classList.remove('active');
                            };
                            reader.readAsDataURL(selectedBannerFile);
                        } else if (bannerPreviewImg.src) {
                            currentUser.banner = bannerPreviewImg.src;
                            saveUserData();
                            updateProfileUI();
                            bannerSelector.classList.remove('active');
                            bannerPreview.classList.remove('active');
                        }
                    }
                });
            }
            
            // Save name
            if (saveNameBtn) {
                saveNameBtn.addEventListener('click', () => {
                    if (currentUser && nameInput.value.trim() !== '') {
                        const [firstName, ...lastName] = nameInput.value.trim().split(' ');
                        currentUser.first_name = firstName;
                        currentUser.last_name = lastName.join(' ');
                        saveUserData();
                        updateProfileUI();
                        tg.showAlert('Имя успешно обновлено!');
                    }
                });
            }
            
            // Save username
            if (saveUsernameBtn) {
                saveUsernameBtn.addEventListener('click', () => {
                    if (currentUser && usernameInput.value.trim() !== '') {
                        const newUsername = usernameInput.value.trim().replace('@', '');
                        currentUser.username = newUsername;
                        saveUserData();
                        updateProfileUI();
                        tg.showAlert('Юзернейм успешно обновлен!');
                    }
                });
            }
            
            // Save bio
            if (saveBioBtn) {
                saveBioBtn.addEventListener('click', () => {
                    if (currentUser) {
                        currentUser.bio = bioInput.value.trim();
                        saveUserData();
                        updateProfileUI();
                        tg.showAlert('Описание успешно обновлено!');
                    }
                });
            }
            
            // Logout
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('plugg_user');
                    currentUser = null;
                    profileModal.classList.remove('active');
                    showAuthModal();
                    tg.showAlert('Вы вышли из аккаунта');
                });
            }
            
            // Initialize banner gallery
            const bannerUrls = [
                'https://i.imgur.com/1a1a1a1.jpg',
                'https://i.imgur.com/2b2b2b2.jpg',
                'https://i.imgur.com/3c3c3c3.jpg',
                'https://i.imgur.com/4d4d4d4.jpg',
                'https://i.imgur.com/5e5e5e5.jpg'
            ];
            
            bannerUrls.forEach(url => {
                const item = document.createElement('div');
                item.className = 'banner-gallery-item';
                item.style.backgroundImage = `url('${url}')`;
                item.addEventListener('click', () => {
                    bannerPreviewImg.src = url;
                    bannerPreview.classList.add('active');
                    selectedBannerFile = null;
                });
                bannerGallery.appendChild(item);
            });
        }
        
        // Initialize the app when Telegram WebApp is ready
        if (tg.ready) {
            tg.ready();
            initApp();
        } else {
            tg.onEvent('viewportChanged', () => {
                if (tg.viewportStableHeight > 0) {
                    initApp();
                }
            });
        }
    </script>
</body>
</html>
